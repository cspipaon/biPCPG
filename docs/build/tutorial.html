<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; biPCPG 0.1.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Code documentation" href="code_docs.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> biPCPG
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">biPCPG</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dataset-structure">Dataset structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-the-average-correlation-matrix">Computing the average correlation matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-the-pcpg-network">Computing the PCPG network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-edge-bootstrap-values">Computing edge bootstrap values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_docs.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">biPCPG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">bipcpg</span></code> package facilitates the computation of a Partial Correlation Planar Graph (PCPG) network for datasets
with a bipartite structure, as well as the preparation of the data for this purpose and a bootstrapping procedure to
assess the reliability of the edges in the network. Below we give an example of how to apply these methods to
a toy dataset consisting of countries and the products they export with the aim of obtaining a PCPG network with
products as nodes.</p>
<div class="section" id="dataset-structure">
<span id="dataset-info"></span><h2>Dataset structure<a class="headerlink" href="#dataset-structure" title="Permalink to this headline">¶</a></h2>
<p>Consider a bipartite dataset containing the quantity (in millions of dollars) of a set products exported by a set of
countries. In this toy example, assume we have data for 4 countries, 4 products over a 5 year span with one data point
per year. Lets denote the countries <span class="math notranslate nohighlight">\(c_1\)</span> to <span class="math notranslate nohighlight">\(c_4\)</span>, the products <span class="math notranslate nohighlight">\(p_1\)</span> to <span class="math notranslate nohighlight">\(p_4\)</span>
and the years <span class="math notranslate nohighlight">\(y_1\)</span> to <span class="math notranslate nohighlight">\(y_5\)</span>. Furthermore, denote the quantity of exports a given country does of a given
product in a given year by <span class="math notranslate nohighlight">\(e_{cp}^y\)</span>.</p>
<p>This sort of dataset is usually distributed as a collection of tables indexed over time containing the data for that
given year. Following our example, we would have the following tables or matrices.</p>
<p>For the first year <span class="math notranslate nohighlight">\(y_1\)</span>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p><span class="math notranslate nohighlight">\(p_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_4\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(c_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_4}^{y_1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(c_4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_4}^{y_1}\)</span></p></td>
</tr>
</tbody>
</table>
<p>for the second year <span class="math notranslate nohighlight">\(y_2\)</span>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p><span class="math notranslate nohighlight">\(p_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_4\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_2}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(c_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_2}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_3 p_4}^{y_2}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(c_4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_4 p_4}^{y_2}\)</span></p></td>
</tr>
</tbody>
</table>
<p>and similarly for years <span class="math notranslate nohighlight">\(y_3\)</span>, <span class="math notranslate nohighlight">\(y_4\)</span> and <span class="math notranslate nohighlight">\(y_5\)</span>.</p>
<p>In order to use such a dataset with the <code class="xref py py-mod docutils literal notranslate"><span class="pre">bipcpg</span></code> package, we have to reshape the data such that, instead of having
a matrix per time index, we have a matrix per element of one of the two sets of variables. These matrices
should have rows representing time indices and columns representing the complementary set of variables. In our
example, instead of a matrix per year, we could reshape the dataset into either a matrix per country or a matrix per
product. If we shape the data such that we have one matrix per country and apply the Bipartite PCPG (biPCPG) algorithm,
we would obtain a network whose nodes are products, and vice versa.</p>
<p>Given we want to obtain a network of products, we need to reshape our data such that we have four matrices, one per
country, containing the export time series for each products as columns. Using the notation introduced above, these
matrices have the following structure:</p>
<p>The matrix for country <span class="math notranslate nohighlight">\(c_1\)</span>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p><span class="math notranslate nohighlight">\(p_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_4\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(y_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_2}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_3}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(y_4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_4}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_5\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_2}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_3}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_1 p_4}^{y_5}\)</span></p></td>
</tr>
</tbody>
</table>
<p>the matrix for country <span class="math notranslate nohighlight">\(c_2\)</span>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p><span class="math notranslate nohighlight">\(p_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(p_4\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_1}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(y_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_2}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_3}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(y_4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_4}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_5\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_2}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_3}^{y_5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(e_{c_2 p_4}^{y_5}\)</span></p></td>
</tr>
</tbody>
</table>
<p>and similarly for countries <span class="math notranslate nohighlight">\(c_3\)</span> and <span class="math notranslate nohighlight">\(c_4\)</span>.</p>
<p>Now lets see how the above translates into code. Take the following <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, with a matrix <strong>per year</strong> as an
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">... </span><span class="n">dataset</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">],</span>                 <span class="c1"># y_1 data</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">10.2</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">,</span> <span class="mf">11.7</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">],</span>            <span class="c1">#</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">101.7</span><span class="p">,</span> <span class="mf">99.7</span><span class="p">,</span> <span class="mf">104.2</span><span class="p">,</span> <span class="mf">103.8</span><span class="p">],</span>        <span class="c1">#</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">1001.9</span><span class="p">,</span> <span class="mf">1002.7</span><span class="p">,</span> <span class="mf">1000.7</span><span class="p">,</span> <span class="mf">1004.7</span><span class="p">]]),</span> <span class="c1">#</span>
<span class="gp">... </span>           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">],</span>               <span class="c1">## y_2 data</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">9.1</span><span class="p">,</span> <span class="mf">12.2</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">,</span> <span class="mf">11.7</span><span class="p">],</span>            <span class="c1">##</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">105.5</span><span class="p">,</span> <span class="mf">102.9</span><span class="p">,</span> <span class="mf">106.5</span><span class="p">,</span> <span class="mf">101.9</span><span class="p">],</span>       <span class="c1">##</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">1004.4</span><span class="p">,</span> <span class="mf">999.4</span><span class="p">,</span> <span class="mf">1001.8</span><span class="p">,</span> <span class="mf">1005.2</span><span class="p">]]),</span>  <span class="c1">##</span>
<span class="gp">... </span>           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">],</span>                <span class="c1">### y_3 data</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">15.4</span><span class="p">,</span> <span class="mf">14.</span><span class="p">,</span> <span class="mf">12.6</span><span class="p">,</span> <span class="mf">15.8</span><span class="p">],</span>            <span class="c1">###</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">98.9</span><span class="p">,</span> <span class="mf">103.2</span><span class="p">,</span> <span class="mf">100.5</span><span class="p">,</span> <span class="mf">104.2</span><span class="p">],</span>        <span class="c1">###</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">1000.9</span><span class="p">,</span> <span class="mf">1003.8</span><span class="p">,</span> <span class="mf">1002.6</span><span class="p">,</span> <span class="mf">1006.6</span><span class="p">]]),</span> <span class="c1">###</span>
<span class="gp">... </span>           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>                <span class="c1">#### y_4 data</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">11.4</span><span class="p">,</span> <span class="mf">12.4</span><span class="p">,</span> <span class="mf">11.7</span><span class="p">,</span> <span class="mf">14.7</span><span class="p">],</span>           <span class="c1">####</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">98.4</span><span class="p">,</span> <span class="mf">103.4</span><span class="p">,</span> <span class="mf">104.3</span><span class="p">,</span> <span class="mf">104.9</span><span class="p">],</span>        <span class="c1">####</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">1006.3</span><span class="p">,</span> <span class="mf">1003.</span><span class="p">,</span> <span class="mf">1003.4</span><span class="p">,</span> <span class="mf">1002.8</span><span class="p">]]),</span>  <span class="c1">####</span>
<span class="gp">... </span>           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span>                <span class="c1">##### y_5 data</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">16.4</span><span class="p">,</span> <span class="mf">15.7</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">],</span>           <span class="c1">#####</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">104.2</span><span class="p">,</span> <span class="mf">102.3</span><span class="p">,</span> <span class="mf">105.</span><span class="p">,</span> <span class="mf">104.4</span><span class="p">],</span>        <span class="c1">#####</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="mf">999.6</span><span class="p">,</span> <span class="mf">1003.3</span><span class="p">,</span> <span class="mf">1005.3</span><span class="p">,</span> <span class="mf">1003.7</span><span class="p">]])]</span>  <span class="c1">#####</span>
</pre></div>
</div>
<p>Recall that each array in the list <code class="docutils literal notranslate"><span class="pre">dataset</span></code> represents the exports (in millions of dollars) for a given year, where
rows represent countries and columns represent products. We would therefore have:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(e_{c_1 p_1}^{y_1}=\$1.2 \text{M}\)</span> = <code class="docutils literal notranslate"><span class="pre">dataset[0][0][0]</span> <span class="pre">*</span> <span class="pre">10**6</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(e_{c_3 p_2}^{y_2}=\$102.9 \text{M}\)</span> = <code class="docutils literal notranslate"><span class="pre">dataset[1][2][1]</span> <span class="pre">*</span> <span class="pre">10**6</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(e_{c_2 p_1}^{y_4}=\$11.4 \text{M}\)</span> = <code class="docutils literal notranslate"><span class="pre">dataset[3][1][0]</span> <span class="pre">*</span> <span class="pre">10**6</span></code></p></li>
</ul>
<p>Now let’s see how we can convert the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> with a matrix per year into a <code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code> with one matrix
per country. In order to do the necessary reshaping we simply do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bipcpg.utils.utils</span> <span class="kn">import</span> <span class="n">reshape_year_matrices_to_time_series_matrices</span>
<span class="gp">... </span><span class="n">timeseries_dataset</span> <span class="o">=</span> <span class="n">reshape_year_matrices_to_time_series_matrices</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <a class="reference internal" href="code_docs.html#bipcpg.utils.utils.reshape_year_matrices_to_time_series_matrices" title="bipcpg.utils.utils.reshape_year_matrices_to_time_series_matrices"><code class="xref py py-func docutils literal notranslate"><span class="pre">reshape_year_matrices_to_time_series_matrices()</span></code></a> converts this into a list of
<strong>country</strong> matrices, i.e. the rows of the matrices in <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, not the columns. We therefore get:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timeseries_dataset</span>
<span class="go">[array([[1.2,  3. , 1. , 5.4],</span>
<span class="go">         [0.1, 5.2, 4.5, 4.2],</span>
<span class="go">         [1.3, 2.3, 1. , 5.9],</span>
<span class="go">         [0.9, 4. , 4.9, 0.6],</span>
<span class="go">         [2. , 0.5, 5.9, 3.1]]),</span>
<span class="go">array([[10.2,  8.8, 11.7, 15.2],</span>
<span class="go">         [ 9.1, 12.2, 13.4, 11.7],</span>
<span class="go">         [15.4, 14. , 12.6, 15.8],</span>
<span class="go">         [11.4, 12.4, 11.7, 14.7],</span>
<span class="go">         [11.7, 16.4, 15.7, 14.9]]),</span>
<span class="go">array([[101.7,  99.7, 104.2, 103.8],</span>
<span class="go">         [105.5, 102.9, 106.5, 101.9],</span>
<span class="go">         [ 98.9, 103.2, 100.5, 104.2],</span>
<span class="go">         [ 98.4, 103.4, 104.3, 104.9],</span>
<span class="go">         [104.2, 102.3, 105. , 104.4]]),</span>
<span class="go">array([[1001.9, 1002.7, 1000.7, 1004.7],</span>
<span class="go">         [1004.4,  999.4, 1001.8, 1005.2],</span>
<span class="go">         [1000.9, 1003.8, 1002.6, 1006.6],</span>
<span class="go">         [1006.3, 1003. , 1003.4, 1002.8],</span>
<span class="go">         [ 999.6, 1003.3, 1005.3, 1003.7]])]</span>
</pre></div>
</div>
<p>We now have each matrix in the list <code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code> representing a country with the export time series as its
columns. This is the desired format any dataset should have in order to apply the biPCPG algorithm.</p>
</div>
<div class="section" id="computing-the-average-correlation-matrix">
<span id="correlations-info"></span><h2>Computing the average correlation matrix<a class="headerlink" href="#computing-the-average-correlation-matrix" title="Permalink to this headline">¶</a></h2>
<p>The input to the PCPG algorithm, which is the last step in the biPCPG algorithm, is a correlation matrix. However, a
bipartite dataset consists of a <em>collection</em> of multiple samples of data (in our toy example above, multiple countries
each exporting multiple products), so the application of the PCPG algorithm to this dataset is not straightforward.
To circumvent this problem, the approach taken in the biPCPG algorithm is to compute a correlation matrix for each
country and then take the element-wise average of these matrices. This yields a single average correlation matrix which
can then be used as the input to the PCPG algorithm.</p>
<p>In order to do this using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">bipcpg</span></code> package, we simply take the dataset in a format like
<code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code>, this is a collection of matrices with observations (which form time series in our example) along
its columns and do the following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bipcpg.correlations</span> <span class="kn">import</span> <span class="n">get_correlation_matrices_for_list_of_matrices</span>
<span class="gp">... </span><span class="n">correlation_matrices</span> <span class="o">=</span> <span class="n">get_correlation_matrices_for_list_of_matrices</span><span class="p">(</span><span class="n">timeseries_dataset</span><span class="p">)</span>
<span class="gp">... </span><span class="n">avg_correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">correlation_matrices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">avg_correlation_matrix</span>
<span class="go">array([[ 1.      , -0.29375 ,  0.11955 , -0.093725],</span>
<span class="go">       [-0.29375 ,  1.      ,  0.252425, -0.0146  ],</span>
<span class="go">       [ 0.11955 ,  0.252425,  1.      , -0.474325],</span>
<span class="go">       [-0.093725, -0.0146  , -0.474325,  1.      ]])</span>
</pre></div>
</div>
<p>as expect from the linearity of the time series in <code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code>, correlation coefficients are all equal to
one. It is important to note that <a class="reference internal" href="code_docs.html#bipcpg.correlations.get_correlation_matrices_for_list_of_matrices" title="bipcpg.correlations.get_correlation_matrices_for_list_of_matrices"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_correlation_matrices_for_list_of_matrices()</span></code></a> computes the
correlations among the <strong>columns</strong> of the matrices in the input list. Also, to filter the returned correlation matrices
based on a statistical T-test, we can pass the desired <code class="docutils literal notranslate"><span class="pre">critical_value</span></code> for the p-values, for example <code class="docutils literal notranslate"><span class="pre">0.05</span></code>, as an
argument like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_correlation_matrices</span> <span class="o">=</span> <span class="n">get_correlation_matrices_for_list_of_matrices</span><span class="p">(</span><span class="n">timeseries_dataset</span><span class="p">,</span>
<span class="gp">... </span>                                                                              <span class="n">critical_value</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_correlation_matrices</span>
<span class="go">[array([[ 1.      , -0.979757,       nan,       nan],</span>
<span class="go">        [-0.979757,  1.      ,       nan,       nan],</span>
<span class="go">        [      nan,       nan,  1.      ,       nan],</span>
<span class="go">        [      nan,       nan,       nan,  1.      ]]),</span>
<span class="go">array([[ 1., nan, nan, nan],</span>
<span class="go">        [nan,  1., nan, nan],</span>
<span class="go">        [nan, nan,  1., nan],</span>
<span class="go">        [nan, nan, nan,  1.]]),</span>
<span class="go">array([[ 1., nan, nan, nan],</span>
<span class="go">        [nan,  1., nan, nan],</span>
<span class="go">        [nan, nan,  1., nan],</span>
<span class="go">        [nan, nan, nan,  1.]]),</span>
<span class="go">array([[ 1., nan, nan, nan],</span>
<span class="go">        [nan,  1., nan, nan],</span>
<span class="go">        [nan, nan,  1., nan],</span>
<span class="go">        [nan, nan, nan,  1.]])]</span>
</pre></div>
</div>
<p>These <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> values are the result of the filtering of non-statistically significant correlations. This is expected
given the very small sample size in our toy dataset.</p>
</div>
<div class="section" id="computing-the-pcpg-network">
<h2>Computing the PCPG network<a class="headerlink" href="#computing-the-pcpg-network" title="Permalink to this headline">¶</a></h2>
<p>Once we have a correlation matrix, or in the example above, an average correlation matrix <code class="docutils literal notranslate"><span class="pre">avg_correlation_matrix</span></code> we
can begin to compute the PCPG network. To do this, first instantiate the PCPG class passing the correlation matrix as an
argument</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bipcpg.pcpg</span> <span class="kn">import</span> <span class="n">PCPG</span>
<span class="gp">... </span><span class="n">pcpg</span> <span class="o">=</span> <span class="n">PCPG</span><span class="p">(</span><span class="n">avg_correlation_matrix</span><span class="p">)</span>
</pre></div>
</div>
<p>we then compute the <em>average influence</em> (see <a class="reference internal" href="theory.html#theory"><span class="std std-ref">Theory</span></a> section) values among the variables in the system</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">compute_avg_influence_matrix</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">avg_influence_matrix</span>
<span class="go">array([[        nan, -0.01044544, -0.02817951,  0.01193706],</span>
<span class="go">       [-0.04052413,         nan, -0.03887709,  0.01047045],</span>
<span class="go">       [-0.00396688, -0.04729008,         nan, -0.0946936 ],</span>
<span class="go">       [ 0.0182888 , -0.01188309,  0.00370091,         nan]])</span>
</pre></div>
</div>
<p>After computing the <code class="docutils literal notranslate"><span class="pre">avg_influence_matrix</span></code> we are able to generate the a <code class="docutils literal notranslate"><span class="pre">networkx.DiGraph</span></code> object of our PCPG
network by doing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">create_network</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">network</span>
<span class="go">&lt;networkx.classes.digraph.DiGraph object at 0x7f9bc5559f10&gt;</span>
</pre></div>
</div>
<p>We can check which edges have been included in <code class="docutils literal notranslate"><span class="pre">pcpg.network</span></code> using <code class="docutils literal notranslate"><span class="pre">networkx</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
<span class="go">OutEdgeView([(0, 1), (1, 3), (1, 2), (2, 0), (3, 0), (3, 2)])</span>
</pre></div>
</div>
<p>or directly via the class attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">edges</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">edges</span>
<span class="go">[(3, 0), (1, 3), (3, 2), (2, 0), (0, 1), (1, 2)]</span>
</pre></div>
</div>
</div>
<div class="section" id="computing-edge-bootstrap-values">
<h2>Computing edge bootstrap values<a class="headerlink" href="#computing-edge-bootstrap-values" title="Permalink to this headline">¶</a></h2>
<p>In order to assess the reliability of a PCPG network’s edges we can perform a bootstrap procedure on the dataset
<code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code>. As detailed above in <a class="reference internal" href="#dataset-info"><span class="std std-ref">Dataset structure</span></a>, this should be an iterable containing matrices whose
columns contain observations for one of the the two sets of variables in a bipartite dataset with a matrix for each
variable in the complementary set of variables.</p>
<p>To obtain a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> containing the edge bootstrap values we simply have to do</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bipcpg.bootstrap</span> <span class="kn">import</span> <span class="n">get_bootstrap_values</span>
<span class="gp">... </span><span class="n">bootstrap_values</span> <span class="o">=</span> <span class="n">get_bootstrap_values</span><span class="p">(</span><span class="n">timeseries_dataset</span><span class="p">,</span> <span class="n">num_replicates</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">num_replicates</span></code> is the number of replicates to be generated in the bootstrap procedure. As when computing
correlations for the average correlation matrix (see <a class="reference internal" href="#correlations-info"><span class="std std-ref">Computing the average correlation matrix</span></a>). This gives the following results, which
may vary when repeated as the bootstrap procedure involves a <em>random</em> resampling of the rows in each matrix in
<code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bootstrap_values</span>
<span class="go">       0      1      2      3</span>
<span class="go">0  0.000  0.897  0.222  0.288</span>
<span class="go">1  0.099  0.000  0.660  0.606</span>
<span class="go">2  0.774  0.315  0.000  0.264</span>
<span class="go">3  0.708  0.377  0.721  0.000</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bootstrap_values</span></code> is a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> containing the bootstrap values of the <em>directed</em> edges in the PCPG
network. For a given entry in this dataframe, the row index is the edge’s source and the column index is the edge’s
target. In our example the entry <code class="code docutils literal notranslate"><span class="pre">bootstrap_values.loc[2,</span> <span class="pre">0]</span> <span class="pre">=</span> <span class="pre">0.774</span></code> is the bootstrap value of the edge
from product <span class="math notranslate nohighlight">\(p_3\)</span> to product <span class="math notranslate nohighlight">\(p_1\)</span>. Note the <code class="docutils literal notranslate"><span class="pre">bootstrap_values</span></code> dataframe includes the bootstrap
values for all <em>potential</em> edges in a PCPG network generated from the <code class="docutils literal notranslate"><span class="pre">timeseries_dataset</span></code>. However, the
<code class="docutils literal notranslate"><span class="pre">pcpg.network</span></code> found above will contain only a part of these.</p>
<p>Also note that <code class="docutils literal notranslate"><span class="pre">critical_value</span></code> argument could also be passed to <a class="reference internal" href="code_docs.html#bipcpg.bootstrap.get_bootstrap_values" title="bipcpg.bootstrap.get_bootstrap_values"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_bootstrap_values()</span></code></a> which
would filter correlations based on a T-test as described in <a class="reference internal" href="#correlations-info"><span class="std std-ref">Computing the average correlation matrix</span></a>.</p>
<p>Note <code class="docutils literal notranslate"><span class="pre">bootstrap_values</span></code> is a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> containing the bootstrap values of the <em>directed</em> edges in the PCPG
network. For a given entry in this dataframe, the row index is the edge’s source and the column index is the edge’s
target.</p>
<p>These bootstrap values could be added as an attribute to <code class="docutils literal notranslate"><span class="pre">pcpg.network</span></code> we obtained previously by doing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pcpg</span><span class="o">.</span><span class="n">add_edge_attribute</span><span class="p">(</span><span class="n">attr_data</span><span class="o">=</span><span class="n">bootstrap_values</span><span class="p">,</span> <span class="n">attr_name</span><span class="o">=</span><span class="s1">&#39;bootstrap_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and we can check the attributes that edges have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="gp">... </span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">pcpg</span><span class="o">.</span><span class="n">network</span><span class="p">,</span> <span class="s1">&#39;bootstrap_value&#39;</span><span class="p">)</span>
<span class="go">{(0, 1): 0.897, (1, 3): 0.606, (1, 2): 0.66, (2, 0): 0.774, (3, 0): 0.708, (3, 2): 0.721}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We recommend reproducing the tutorial’s code snippets including the product names <code class="code docutils literal notranslate"><span class="pre">['p1',</span> <span class="pre">'p2',</span> <span class="pre">'p3',</span> <span class="pre">'p4']</span></code>
as an argument <code class="code docutils literal notranslate"><span class="pre">variable_names</span></code> to <a class="reference internal" href="code_docs.html#bipcpg.pcpg.PCPG" title="bipcpg.pcpg.PCPG"><code class="xref py py-class docutils literal notranslate"><span class="pre">PCPG</span></code></a>, which changes the <code class="docutils literal notranslate"><span class="pre">pcpg.edges</span></code> and
<code class="docutils literal notranslate"><span class="pre">pcpg.nodes</span></code> names. We should also pass the same argument to <a class="reference internal" href="code_docs.html#bipcpg.bootstrap.get_bootstrap_values" title="bipcpg.bootstrap.get_bootstrap_values"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_bootstrap_values()</span></code></a> in
order to obtain a <code class="docutils literal notranslate"><span class="pre">bootstrap_values</span></code> dataframe with product names as row and columns indices.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="code_docs.html" class="btn btn-neutral float-right" title="Code documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Carlos Saenz de Pipaon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>